(function(f){var e="imagecube";var a=0;var d=1;var b=2;var c=3;f.JQPlugin.createPlugin({name:e,defaultOptions:{direction:"random",randomSelection:["up","down","left","right"],speed:2000,easing:"linear",repeat:true,pause:2000,selection:"forward",shading:true,opacity:0.8,imagePath:"",full3D:true,segments:20,reduction:30,expansion:10,lineHeight:[0,1.25],letterSpacing:[-0.4,0],beforeRotate:null,afterRotate:null},_getters:["current","next"],_instSettings:function(h,g){return{_position:h.css("position")}},_postAttach:function(g,h){g.css({position:"relative"}).children().each(function(){var i=f(this);i.data(e,{display:i.css("display"),width:i.css("width"),height:i.css("height"),position:i.css("position"),lineHeight:i.css("lineHeight"),letterSpacing:i.css("letterSpacing")}).css({display:"block",width:g.css("width"),height:g.css("height"),position:"absolute",lineHeight:h.options.lineHeight[1],letterSpacing:h.options.letterSpacing[1]})}).not(":first").hide();this._prepareRotation(g)},_optionsChanged:function(h,i,g){f.extend(i.options,g);this._prepareRotation(h)},_prepareRotation:function(i){i=f(i);i.children(".imageCubeShading,.imageCubeFrom,.imageCubeTo").remove();var j=this._getInst(i[0]);j.current=i.children(":visible")[0];j.current=(j.current?j.current:i.children(":first")[0]);var h=function(k){return(!k.length?k:k.filter(":eq("+Math.floor(Math.random()*k.length)+")"))};j.next=(j.options.selection=="random"?h(i.children(":hidden")):(j.options.selection=="backward"?f(j.current).prev():f(j.current).next()));j.next=(j.next.length?j.next:(j.options.selection=="random"?j.current:(j.options.selection=="backward"?i.children(":last"):i.children(":first"))))[0];if(j.options.repeat&&!j._timer){var g=this;j._timer=setTimeout(function(){g.rotate(i)},j.options.pause)}},rotate:function(i,h,l){i=f(i);if(!i.hasClass(this._getMarker())){return}if(typeof h=="function"){l=h;h=null}this.stop(i,true);var j=this._getInst(i[0]);if(h!=null){h=(typeof h=="number"?i.children(":eq("+h+")"):f(h));if(i.children().filter(function(){return this===h[0]}).length>0){j.next=h}}var k=[j.current,j.next];if(f.isFunction(j.options.beforeRotate)){j.options.beforeRotate.apply(i[0],k)}var g={};g[e]=1;i.attr(e,0).stop(true,true).animate(g,j.options.speed,j.options.easing,function(){if(f.isFunction(j.options.afterRotate)){j.options.afterRotate.apply(i[0],k)}if(l){l.apply(i[0])}})},current:function(g){g=f(g);return(g.hasClass(this._getMarker())?this._getInst(g[0]).current:null)},next:function(g){g=f(g);return(g.hasClass(this._getMarker())?this._getInst(g[0]).next:null)},stop:function(h,g){h=f(h);if(!h.hasClass(this._getMarker())){return}var i=this._getInst(h[0]);if(i._timer){clearTimeout(i._timer);i._timer=null}if(!g){i.options.repeat=false}},start:function(g){this.option(g,{repeat:true})},_preDestroy:function(g,h){this.stop(g);var h=this._getInst(g[0]);g.stop().css({position:h._position}).children(".imageCubeShading,.imageCubeFrom,.imageCubeTo").remove();g.children().each(function(){var i=f(this);i.css(i.data(e)).removeData(e)}).show()},_prepareAnimation:function(v){v=f(v);var k=this._getInst(v[0]);var o={left:0,top:0};v.parents().each(function(){var i=f(this);if(i.css("position")=="fixed"){o.left-=i.offset().left;o.top-=i.offset().top;return false}});var r={width:v.width(),height:v.height()};var z=(k.options.direction!="random"?k.options.direction:k.options.randomSelection[Math.floor(Math.random()*k.options.randomSelection.length)]);z=Math.max(0,f.inArray(z,["up","down","left","right"]));k._curDirection=z;var l=(z==a||z==d);var n=(z==b||z==c);var A=(z==a||z==b);var q=(A?0:k.options.opacity);var g=f(k.current);var m=f(k.next);var s=[];var h=function(C){var i=[0,0,0,0];if(C.css("border")!=undefined){f.each(["Left","Right","Top","Bottom"],function(E,D){i[E]=C.css("border"+D+"Width");i[E]=parseFloat({thin:1,medium:3,thick:5}[i[E]]||i[E])})}return i};s[0]=h(g);s[1]=h(m);var w=[];w[0]=[parseFloat(g.css("padding-left")),parseFloat(g.css("padding-right")),parseFloat(g.css("padding-top")),parseFloat(g.css("padding-bottom"))];w[1]=[parseFloat(m.css("padding-left")),parseFloat(m.css("padding-right")),parseFloat(m.css("padding-top")),parseFloat(m.css("padding-bottom"))];var p=[];p[0]=(f.support.boxModel?[s[0][0]+s[0][1]+w[0][0]+w[0][1],s[0][2]+s[0][3]+w[0][2]+w[0][3]]:[0,0]);p[1]=(f.support.boxModel?[s[1][0]+s[1][1]+w[1][0]+w[1][1],s[1][2]+s[1][3]+w[1][2]+w[1][3]]:[0,0]);var y=[];y[0]={elem:g[0],props:{left:{start:o.left,end:o.left+(z==c?r.width:0),units:"px"},width:{start:r.width-p[0][0],end:(l?r.width-p[0][0]:0),units:"px"},top:{start:o.top,end:o.top+(z==d?r.height:0),units:"px"},height:{start:r.height-p[0][1],end:(l?0:r.height-p[0][1]),units:"px"},paddingLeft:{start:w[0][0],end:(n?0:w[0][0]),units:"px"},paddingRight:{start:w[0][1],end:(n?0:w[0][1]),units:"px"},paddingTop:{start:w[0][2],end:(l?0:w[0][2]),units:"px"},paddingBottom:{start:w[0][3],end:(l?0:w[0][3]),units:"px"},borderLeftWidth:{start:s[0][0],end:(n?0:s[0][0]),units:"px"},borderRightWidth:{start:s[0][1],end:(n?0:s[0][1]),units:"px"},borderTopWidth:{start:s[0][2],end:(l?0:s[0][2]),units:"px"},borderBottomWidth:{start:s[0][3],end:(l?0:s[0][3]),units:"px"},lineHeight:{start:k.options.lineHeight[1],end:(l?k.options.lineHeight[0]:k.options.lineHeight[1]),units:"em"},letterSpacing:{start:k.options.letterSpacing[1],end:(l?k.options.letterSpacing[1]:k.options.letterSpacing[0]),units:"em"}}};y[1]={elem:m[0],props:{left:{start:o.left+(z==b?r.width:0),end:o.left,units:"px"},width:{start:(l?r.width-p[1][0]:0),end:r.width-p[1][0],units:"px"},top:{start:o.top+(z==a?r.height:0),end:o.top,units:"px"},height:{start:(l?0:r.height-p[1][1]),end:r.height-p[1][1],units:"px"},paddingLeft:{start:(n?0:w[1][0]),end:w[1][0],units:"px"},paddingRight:{start:(n?0:w[1][1]),end:w[1][1],units:"px"},paddingTop:{start:(l?0:w[1][2]),end:w[1][2],units:"px"},paddingBottom:{start:(l?0:w[1][3]),end:w[1][3],units:"px"},borderLeftWidth:{start:(n?0:s[1][0]),end:s[1][0],units:"px"},borderRightWidth:{start:(n?0:s[1][1]),end:s[1][1],units:"px"},borderTopWidth:{start:(l?0:s[1][2]),end:s[1][2],units:"px"},borderBottomWidth:{start:(l?0:s[1][3]),end:s[1][3],units:"px"},lineHeight:{start:(l?k.options.lineHeight[0]:k.options.lineHeight[1]),end:k.options.lineHeight[1],units:"em"},letterSpacing:{start:(l?k.options.letterSpacing[1]:k.options.letterSpacing[0]),end:k.options.letterSpacing[1],units:"em"}}};if(k.options.shading){var x=function(D,C,i){return{left:{start:D.left.start,end:D.left.end,units:"px"},width:{start:D.width.start,end:D.width.end,units:"px"},top:{start:D.top.start,end:D.top.end,units:"px"},height:{start:D.height.start,end:D.height.end,units:"px"},paddingLeft:{start:D.paddingLeft.start+D.borderLeftWidth.start,end:D.paddingLeft.end+D.borderLeftWidth.end,units:"px"},paddingRight:{start:D.paddingRight.start+D.borderRightWidth.start,end:D.paddingRight.end+D.borderRightWidth.end,units:"px"},paddingTop:{start:D.paddingTop.start+D.borderTopWidth.start,end:D.paddingTop.end+D.borderTopWidth.end,units:"px"},paddingBottom:{start:D.paddingBottom.start+D.borderBottomWidth.start,end:D.paddingBottom.end+D.borderBottomWidth.end,units:"px"},opacity:{start:C,end:i,units:""}}};y[2]={elem:f((!f.support.opacity?'<img src="'+k.options.imagePath+'imageCubeHigh.png"':"<div")+' class="imageCubeShading" style="background-color: white; opacity: '+q+'; z-index: 10; position: absolute;"'+(!f.support.opacity?"/>":"></div>"))[0],props:x(y[A?0:1].props,q,k.options.opacity-q)};y[3]={elem:f((!f.support.opacity?'<img src="'+k.options.imagePath+'imageCubeShad.png"':"<div")+' class="imageCubeShading" style="background-color: black; opacity: '+(k.options.opacity-q)+'; z-index: 10; position: absolute;"'+(!f.support.opacity?"/>":"></div>"))[0],props:x(y[A?1:0].props,k.options.opacity-q,q)}}if(k.options.full3D){for(var t=0;t<k.options.segments;t++){v.append(g.clone().addClass("imageCubeFrom").css({display:"block",position:"absolute",overflow:"hidden"}));if(k.options.shading){v.append(f(y[A?2:3].elem).clone())}}for(var t=0;t<k.options.segments;t++){v.append(m.clone().addClass("imageCubeTo").css({display:"block",position:"absolute",width:0,overflow:"hidden"}));if(k.options.shading){v.append(f(y[A?3:2].elem).clone())}}g.hide();m.css({width:r.width-p[1][0],height:r.height-p[1][1]})}else{var u=function(i){return{left:i.left.start+"px",width:i.width.start+"px",top:i.top.start+"px",height:i.height.start+"px",lineHeight:i.lineHeight.start+"em",padding:i.paddingTop.start+"px "+i.paddingRight.start+"px "+i.paddingBottom.start+"px "+i.paddingLeft.start+"px",borderLeftWidth:i.borderLeftWidth.start+"px",borderRightWidth:i.borderRightWidth.start+"px",borderTopWidth:i.borderTopWidth.start+"px",borderBottomWidth:i.borderBottomWidth.start+"px",letterSpacing:i.letterSpacing.start+"em",overflow:"hidden"}};g.css(u(y[0].props));m.css(u(y[1].props)).show();if(k.options.shading){v.append(y[2].elem).append(y[3].elem)}}for(var t=0;t<y.length;t++){for(var B in y[t].props){var j=y[t].props[B];j.diff=j.end-j.start}}return y},_drawFull3D:function(h,p,m){h=f(h);var l=h.data(e);if(!l.options.full3D){return false}var s=l._curDirection;var i=(s==a||s==d);var q=(s==a||s==b);var g=h.width();var t=h.height();if(g==0||t==0){return true}var n=(1-p)*(i?t:g);var k=l.options.segments;var r=l.options.expansion*(1-Math.abs(2*n-(i?t:g))/(i?t:g));var o=l.options.reduction-(l.options.reduction*n/(i?t:g));var j=function(z,N,H,x,U,F,D,P,I,B,A,K){var v=[x-N,F-P];var G=Math.max(v[0],v[1]);var Y=[I-H,D-U];var T=Math.max(Y[0],Y[1]);var Z=(i?(v[0]-v[1])/(k-1)/2:G/k);var M=(i?T/k:(Y[0]-Y[1])/(k-1)/2);var S=A.paddingLeft[K]+A.paddingRight[K]+A.borderLeftWidth[K]+A.borderRightWidth[K];var y=A.paddingTop[K]+A.paddingBottom[K]+A.borderTopWidth[K]+A.borderBottomWidth[K];var R=Math.round(N);var J=Math.round(H);var aa=R;var u=J;var Q=0;for(var O=0;O<h[0].childNodes.length;O++){var E=h[0].childNodes[O];if(E.className!=z){continue}var L=Math.round(N+(Q+1)*Z);var X=Math.round(H+(Q+1)*M);var C=v[0]-(i?2*Q*Z:0);var W=Y[0]-(i?0:2*Q*M);E.style.left=(i?aa:N)+"px";E.style.top=(i?H:u)+"px";E.style.width=Math.max(0,C-S)+"px";E.style.height=Math.max(0,W-y)+"px";E.style.letterSpacing=(i?C/G*(l.options.letterSpacing[1]-l.options.letterSpacing[0])+l.options.letterSpacing[0]:p*A.letterSpacing.diff+A.letterSpacing.start)+A.letterSpacing.units;E.style.lineHeight=(!i?W/T*(l.options.lineHeight[1]-l.options.lineHeight[0])+l.options.lineHeight[0]:p*A.lineHeight.diff+A.lineHeight.start)+A.lineHeight.units;E.style.clip="rect("+(!i?"auto":(u-J)+"px")+","+(i?"auto":(L-R)+"px")+","+(!i?"auto":(X-J)+"px")+","+(i?"auto":(aa-R)+"px")+")";if(l.options.shading){var V=E.nextSibling;V.style.left=aa+"px";V.style.top=u+"px";V.style.width=(i?v[0]-2*Q*Z:L-aa)+"px";V.style.height=(i?X-u:Y[0]-2*Q*M)+"px";V.style.opacity=B;if(!f.support.opacity){V.style.filter="alpha(opacity="+(B*100)+")"}}aa=L;u=X;Q++}};j("imageCubeFrom",[o,-r,0,g-n][s],[0,t-n,o,-r][s],[g-o,g+r,n,g][s],[0,t-n,-r,o][s],[g+r,g-o,n,g][s],[n,t,t+r,t-o][s],[-r,o,0,g-n][s],[n,t,t-o,t+r][s],(!l.options.shading?0:(q?p:1-p)*m[2].props.opacity.diff+m[2].props.opacity.start),m[0].props,"start");j("imageCubeTo",[-r,l.options.reduction-o,n,0][s],[n,0,-r,l.options.reduction-o][s],[g+r,g-(l.options.reduction-o),g,g-n][s],[n,0,l.options.reduction-o,-r][s],[g-(l.options.reduction-o),g+r,g,g-n][s],[t,t-n,t-(l.options.reduction-o),t+r][s],[l.options.reduction-o,-r,n,0][s],[t,t-n,t+r,t-(l.options.reduction-o)][s],(!l.options.shading?0:(q?p:1-p)*m[3].props.opacity.diff+m[3].props.opacity.start),m[1].props,"end");return true}});f.fx.step[e]=function(l){if(!l.stepProps){l.start=0;l.end=1;l.stepProps=f.imagecube._prepareAnimation(l.elem);var k=l.stepProps[0].elem;l.saveCSS={borderLeftWidth:k.style.borderLeftWidth,borderRightWidth:k.style.borderRightWidth,borderTopWidth:k.style.borderTopWidth,borderBottomWidth:k.style.borderBottomWidth,padding:k.style.padding}}if(!f.imagecube._drawFull3D(l.elem,l.pos,l.stepProps)){for(var j=0;j<l.stepProps.length;j++){var g=l.stepProps[j];for(var h in g.props){var m=g.props[h];g.elem.style[h]=(l.pos*m.diff+m.start)+m.units;if(!f.support.opacity&&h=="opacity"){g.elem.style.filter="alpha(opacity="+((l.pos*m.diff+m.start)*100)+")"}}}}if(l.pos==1){f(l.stepProps[0].elem).hide().css(l.saveCSS);f(l.stepProps[1].elem).show();f.imagecube._prepareRotation(l.elem)}}})(jQuery);