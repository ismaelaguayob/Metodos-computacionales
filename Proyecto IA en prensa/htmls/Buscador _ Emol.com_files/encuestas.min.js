// Desarrollo Web - v0.1.23 ?v=15
var COMMENTS_API="//comentarios.emol.com/Comments/Api",COMMENTS_API_CACHE="//cache-comentarios.ecn.cl/Comments/Api",MAX_ANSWERS=1,PRIVATE_MODE=!1;function InitEncuesta(){"undefined"==typeof GlobalHost&&(GlobalHost="//static.emol.cl/emol50"),$(".encuesta-emol").each((function(){var t=$(this).attr("data-id");$(this);"ok"!=$(this).attr("data-status")&&($(this).html($("<div>").attr("class","poll-loading").html("Cargando..")),CratePoll(t))}))}function CratePoll(t){var a=$('.encuesta-emol[data-id="'+t+'"]');""!=getCookie("SSTES")&&"undefined"!=getCookie("SSTES")?a.attr("data-status","ok"):a.attr("data-status","not-login"),$.get(COMMENTS_API_CACHE,{async:!1,action:"getPoll",pollId:t}).done((function(e){var s=jQuery.parseJSON(e);MAX_ANSWERS=s.maxAnswers,PRIVATE_MODE=s.privateMode;try{""!=s.css?($("head").append($('<link rel="stylesheet" type="text/css" />').attr("href",s.css)),$("LINK[href*='encuestas.css']").remove()):$("head").append($('<link rel="stylesheet" type="text/css" />').attr("href",GlobalHost+"/css/encuestas.css?v=5"))}catch(t){}a.attr("data-private",s.privateMode),a.attr("data-answers",s.maxAnswers),a.html(""),a.append($("<div>").attr("class","answer-title answer-"+t+"-title").html(s.title)),0==s.open&&a.append($("<div>").attr("class","poll-end-banner").append($("<span>").attr("class","poll-txt-end").html("Encuesta finalizada"),$("<span>").attr("class","poll-line-end")));var l=$("<table>").attr("style","width: 100%;").attr("class","answer-table answer-table-"+s.id);s.answers.forEach((function(a){var e="";""==a.urlPhoto&&(e="img-not");var s=$("<tr>").attr("class","tr-poll-"+a.id+" "+e);s.append($("<td>").attr("class","td-radio").append($("<input>").attr("id","answer-"+a.id).attr("class","answer-radio-"+t).attr("related-id",a.relatedPollId).attr("type","checkbox").attr("name","answer-"+t).attr("value",a.id),$("<label>").attr("for","answer-"+a.id).attr("class","answer-text").html("x"))),""!=a.urlPhoto?s.append($("<td>").attr("class","td-img").append($("<img>").attr("class","answer-img").attr("src",a.urlPhoto.replace("http:","https:")))):s.append($("<td>").attr("class","td-img-not")),s.append($("<td>").attr("class","td-text").append($("<label>").attr("for","answer-"+a.id).attr("class","answer-text").html(a.answer))),l.append(s)})),a.append(l),a.append($("<div>").attr("id","poll-view-text-"+t).attr("class","poll-view-text-end")),""!=getCookie("SSTES")&&"undefined"!=getCookie("SSTES")?$("#poll-view-text-"+t).append($("<div>").attr("class","button-save-poll button-save-poll-"+t).attr("onclick","GetAnswer("+t+")").html(" Votar ")):$("#poll-view-text-"+t).append($("<div>").attr("id","poll-view-"+t).attr("class","poll-view").append($("<div>").attr("class","poll-text-init-cession").html("Debes iniciar sesi&oacute;n para participar."),$("<div>").attr("class","cont_bt_mer_pram btn_pram_login").attr("style","display:block;").append($("<a>").attr("href","javascript:void(0);").attr("onclick",'$("#loginEmol").modal("show");CambiarTab("divLogin");').append($("<span>").attr("class","cont_icon_mer_emol_s").append($("<img>").attr("src","//static.emol.cl/emol50/img/emol_sesion.png")),$("<span>").attr("class","cont_txt_bt_emol_se").append("Iniciar sesi&oacute;n")))));var o=new Array,n=getCookie("emol_polls");null!=n&&(o=(n=unescape(n)).split(",")),s.open&&!o.includes(t.toString())||($(".button-save-poll-"+t).addClass("poll-button-disabled").html("Ya votaste"),$(".button-save-poll-"+t).removeAttr("onclick"),"true"!=$('.encuesta-emol[data-id="'+t+'"]').attr("data-private")?GetResult(t):(a.addClass("poll-end"),$("#poll-view-text-"+t).append($("<div>").attr("class","poll-text-date-end").append("Los Resultados ser&aacute;n publicados"))),0==s.open&&$(".button-save-poll-"+t).remove())}))}function GetAnswer(t){if(""!=getCookie("SSTES")&&"undefined"!=getCookie("SSTES")&&null!=getCookie("SSTES")){var a=0;if($(".answer-radio-"+t+":checkbox:checked").each((function(){a+=1})),a.toString()==$('.encuesta-emol[data-id="'+t+'"]').attr("data-answers")){$(".button-save-poll-"+t).addClass("poll-button-disabled").html("Ya votaste"),$(".answer-radio-"+t+":checkbox:checked").each((function(a){var e=$(this).val();$.get(COMMENTS_API,{action:"answerPoll",answerId:e,emolToken:getCookie("SSTES")}).done((function(s){var l=!0;try{Temas.includes("Festival de Viña del Mar")&&(l=!1)}catch(t){}l&&modalShareVote(t,e);var o=jQuery.parseJSON(s);o.status,"ok"==o.status&&$(".encuesta-emol").each((function(){$(this).attr("data-id")==t&&$("#status-result-poll-"+t).html("Gracias Por Votar.")})),"already voted or invalid poll"==o.error&&$(".encuesta-emol").each((function(){$(this).attr("data-id")})),a===parseInt($('.encuesta-emol[data-id="'+t+'"]').attr("data-answers"))-1&&("false"==$('.encuesta-emol[data-id="'+t+'"]').attr("data-private")?($(".button-save-poll-"+t).removeAttr("onclick"),console.log("GetResult If"),GetResult(t)):(console.log("GetResult Else"),$(".button-save-poll-"+t).removeAttr("onclick"),$("#poll-view-text-"+t).append($("<div>").attr("class","poll-text-date-end").append("Los Resultados ser&aacute;n publicados."))));var n=$("#answer-"+e).attr("related-id");$.isNumeric(n)&&($('.encuesta-emol[data-id="'+t+'"]').after($("<blockquote>").attr("class","encuesta-emol").attr("data-id",n)),CratePoll(n))}))}));var e=new Array,s=getCookie("emol_polls");null!=s&&(e=(s=unescape(s)).split(",")),e.includes(t.toString())||e.push(t),setCookie("emol_polls",e,"360")}else"1"==$('.encuesta-emol[data-id="'+t+'"]').attr("data-answers")?alert("Debes seleccionar "+$('.encuesta-emol[data-id="'+t+'"]').attr("data-answers")+" opción."):alert("Debes seleccionar "+$('.encuesta-emol[data-id="'+t+'"]').attr("data-answers")+" opciones.")}else{$('.encuesta-emol[data-id="'+t+'"]').attr("data-status","not-login"),console.log("Init Secion error"),$("#poll-view-text-"+t).append($("<div>").attr("id","poll-view-"+t).attr("class","poll-view").append($("<div>").attr("class","poll-text-init-cession").html("Debes iniciar sesi&oacute;n para participar."),$("<div>").attr("class","cont_bt_mer_pram btn_pram_login").attr("style","display:block;").append($("<a>").attr("href","https://pram.elmercurio.com/Login.aspx?ApplicationName=EMOL&SSOTargetUrl="+cmtData.page).append($("<span>").attr("class","cont_icon_mer_emol_s").append($("<img>").attr("src","http://staticemol.gen.emol.cl/img/emol_sesion.png")),$("<span>").attr("class","cont_txt_bt_emol_se").append("Iniciar sesi&oacute;n")))));try{setTimeout(FB.XFBML.parse(),2e3)}catch(t){}$(".button-save-poll-"+t).remove()}}function modalShareVote(t,a){0==$("#trivia_emol_popUp").length&&$("body").append('<div class="emol_modal"><div class="modal fade in" id="trivia_emol_popUp" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="false" style="display: block;"><div class="modal-dialog modal-dialog-centered" role="document"><div class="modal-content"><div class="modal-header"><span><img src="https://static.emol.cl/emol50/img/logo_txt_esocial.png"></span><span class="close" data-dismiss="modal"><i class="fa fa-times"></i></span></div><div class="modal-body"><div class="content_encuesta"><div class="back_top_encuesta"> <img src="https://static.emol.cl/emol50/img/icono_encuesta.png"><span>¡Gracias por tu voto!</span></div><div class="cont_txt_modal_encuesta"> <span class="tit_modal_encuesta"><div class="answer-title">'+$(".answer-"+t+"-title").html()+'</div><span class="icon_squares"> <span class="square_enc"> <i class="fa fa-check"></i> </span> </span> <span class="txt">Voté por:</span></span><i class="fa fa-check-square check_encuesta"></i>'+$(".tr-poll-"+a+" .td-text .answer-text").html()+'<span class="tit_opina_modal">Opina y comparte tu votación</span></div><textarea id="text_area_vex_poll" contenteditable="true" class="text_area_vex" name="text_area_vex" rows="4" cols="50"></textarea><div class="dest_compartir"><div class="btn_compartir_modal" onclick="shareVote('+t+","+a+')" id="btn_compartir_modal"><a href="#">COMPARTIR</a></div></div></div></div><div class="modal-footer"></div></div></div></div></div>'),$("#text_area_vex_poll").val(""),$("#trivia_emol_popUp").modal("show")}function shareVote(t,a){CommentsApi.expressComment("#EncuestarEmol["+t+","+a+"]"+text_area_vex_poll.value),pollReplay(t,a),$("#trivia_emol_popUp").modal("hide")}function pollReplay(t,a){var e="#EncuestarEmol["+t+","+a+","+IDNoticia+"]"+text_area_vex_poll.value,s="POST";/(MSIE 8)|(MSIE 9)/i.test(navigator.userAgent)&&(s="GET");var l=JSON.parse(unescape(getCookie("c_user_p"))).nick.removeAccents().split(" ").join("-");console.log(e),$.ajax({url:urlComments,method:s,dataType:"json",data:{action:"newComment",text:e,url:"https://comentarista.emol.com/"+getCookie("c_user_i")+"/"+l+".html",accessToken:cmtData.accessToken,authType:cmtData.authType,isAdmin:cmtData.isAdmin?"Y":"N",acceptedConditions:cmtData.aprtym?"Y":"N"}}).done((function(t){console.log("Encuesta compartida")})).fail((function(t){console.log("Encuesta compartida")}))}function GetResult(t){$.get(COMMENTS_API,{async:!1,action:"getPollResults",pollId:t}).done((function(a){var e=jQuery.parseJSON(a),s=0;e.forEach((function(t){s+=t.votes})),$("#poll-view-text-"+t).append($("<div>").attr("id","result-poll-value-"+t).attr("class","result-poll-value").html("Votos totales: "+miles(s))),$(".answer-table-"+t).addClass("answer-finished"),e.forEach((function(t){var a=0;if(s>0)a=100*t.votes/s;$(".td-radio-"+t.pollAnswer.id).remove(),$(".td-radio-"+t.pollAnswer.id).remove(),$(".tr-poll-"+t.pollAnswer.id+" .td-radio").remove(),$(".tr-poll-"+t.pollAnswer.id+" .td-text").remove(),$(".tr-poll-"+t.pollAnswer.id+" .td-percent").remove();var e=Math.round(10*a)/10;$(".tr-poll-"+t.pollAnswer.id).append($("<table>").attr("style","width: 100%;").append($("<tr>").append($("<td>").attr("class","answer-text-result").append(t.pollAnswer.answer).append($("<span>").append("<b>Votos:</b> <i>"+miles(t.votes)+"</i>"))),$("<tr>").append($("<td>").attr("class","answer-text-result").append('<div class="grafico"><strong class="barra" style="width: '+e+'%;"></strong><div class="porcentaje">'+e.toString().replace(".",",")+"%</div></div>"))))}))}))}function miles(t){return t=(t=t.toString().split("").reverse().join("").replace(/(?=\d*\.?)(\d{3})/g,"$1.")).split("").reverse().join("").replace(/^[\.]/,"")}$(document).ready((function(){document.cookie=encodeURIComponent("emol_polls")+"=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;","function"==typeof InitEncuesta&&InitEncuesta()}));